{{ define "main" }}
  {{/* Minimal custom index to ensure only one global header comes from baseof and to list homepage sections */}}
  {{ $headless := .GetPage "./homepage" }}
  {{ if hugo.IsMultihost }}
    {{ $headless = .Site.GetPage "/homepage" }}
  {{ end }}
  {{ if not $headless }}
    <main class="content" role="main"><p>Homepage bundle not found.</p></main>
  {{ else }}
    {{ $sections := $headless.Resources.ByType "page" }}
    {{ $sections = cond .Site.BuildDrafts $sections (where $sections "Draft" "==" false) }}
    {{ $sections = where $sections "Content" "ne" "" }}
    <main class="content" role="main">
      {{ range $i, $p := $sections }}
        {{ $title := $p.Title }}
        {{ if $title }}
          <div class='post-holder{{ if and (ne $.Site.Params.invertSectionColors true) (not (modBool $i 2)) }} dark{{ else if and (eq $.Site.Params.invertSectionColors true) (modBool $i 2) }} dark{{ end }}'>
            {{ $isTestimonials := eq (lower $title) "testimonials" }}
            <article id='{{ anchorize $title }}' class='post {{ if $isTestimonials }}post-testimonials{{ end }} {{ if eq $i 0 }}first{{ end }} {{ if eq (add $i 1) (len $sections) }}last{{ end }}'>
              <header class="post-header">
                <h2 class="post-title">{{ $title | emojify | safeHTML }}</h2>
              </header>
              <section class="post-content">
                {{ $p.Content }}
              </section>
            </article>
            <div class='post-after{{ if and (ne $.Site.Params.invertSectionColors true) (modBool $i 2) }} light{{ else if and (eq $.Site.Params.invertSectionColors true) (not (modBool $i 2)) }} light{{ end }}'></div>
          </div>
        {{ end }}
      {{ end }}
    </main>
  {{ end }}
{{ end }}
